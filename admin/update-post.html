<!doctype html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Update Post Â· nijika.de</title>
    <link rel="stylesheet" href="./../assets/styles.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet" />
  </head>
  <body>
    <header class="site-header">
      <div class="container nav">
        <div class="brand">nijika.de</div>
        <div class="nav-actions">
          <button class="theme-toggle" data-toggle-theme title="Toggle theme"><i class="bi bi-brightness-high"></i></button>
        </div>
      </div>
    </header>

    <main class="container" style="padding: 32px 0 48px;">
      <div class="narrow">
        <h2>Update Post</h2>
      </div>
      <form id="updateBlogForm" class="form narrow">
        <div class="field">
          <label for="title">Title</label>
          <input id="title" type="text" placeholder="Title" />
        </div>
        <div class="field">
          <label for="tags">Tags</label>
          <input id="tags" type="text" placeholder="tag1, tag2" />
        </div>
        <div class="field">
          <label>Content</label>
          <div id="editor"></div>
        </div>
        <button class="btn btn-primary" type="submit">Update Post</button>
      </form>
    </main>

    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script type="module">
      import '../assets/app.js';
      const titleInput = document.querySelector('#title');
      const tagsInput = document.querySelector('#tags');
      const quill = new Quill('#editor', {
        theme: 'snow',
        modules: {
          toolbar: [
            [{ header: [1,2,3,4,5,6,false] }],
            ['bold','italic','underline','strike'],
            [{ color: [] }, { background: [] }],
            [{ script: 'sub' }, { script: 'super' }],
            [{ list: 'ordered' }, { list: 'bullet' }],
            [{ indent: '-1' }, { indent: '+1' }],
            [{ align: [] }],
            ['blockquote','code-block'],
            ['link','image','video','formula'],
            ['clean']
          ]
        }
      });
      async function getPostData() {
        const url = new URL(window.location.href);
        const id = url.searchParams.get('id');
        if (!id) return window.location.href = './blogs.html';
        const res = await fetch('https://nijikade-backend.vercel.app/api/post/' + id);
        const data = await res.json();
        titleInput.value = data.data.title;
        tagsInput.value = data.data.tags || '';
        quill.clipboard.dangerouslyPasteHTML(data.data.content);
      }
      getPostData();
      document.querySelector('#updateBlogForm')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const url = new URL(window.location.href);
        const id = url.searchParams.get('id');
        const token = localStorage.getItem('jwt');
        if (!token) return alert('You are not logged in');
        const title = titleInput.value.trim();
        const tags = tagsInput.value.trim();
        const content = quill.root.innerHTML;
        if (!title || !tags || !quill.root.innerText.trim()) return alert('Fill all the fields');
        const res = await fetch(`https://nijikade-backend.vercel.app/api/post/${id}?token=${token}`, {
          method: 'PATCH', headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ title, content, tags })
        });
        if (!res.ok) { const j = await res.json(); return alert(j.error || 'Failed'); }
        alert('Post updated successfully');
      });
    </script>
  </body>
</html>


