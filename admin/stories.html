<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Stories Â· nijika.de</title>
    <link rel="stylesheet" href="./../assets/styles.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
</head>
<body>
    <!-- Color Picker Modal -->
    <div class="color-picker-modal" data-color-modal>
      <div class="color-picker-content">
        <div class="color-picker-header">
          <h3>Choose Your Color</h3>
          <button class="color-picker-close" data-color-close>
            <i class="bi bi-x-lg"></i>
          </button>
        </div>
        <div class="color-picker-options">
          <button class="color-option" data-color="cyan" title="Cyan (Current)">
            <div class="color-preview" style="background: linear-gradient(135deg, #6de6e2, #a8f5f2);"></div>
            <span>Cyan</span>
          </button>
          <button class="color-option" data-color="pink" title="Pink (Original)">
            <div class="color-preview" style="background: linear-gradient(135deg, #ff6b9d, #ffa4c4);"></div>
            <span>Pink</span>
          </button>
          <button class="color-option" data-color="purple" title="Purple">
            <div class="color-preview" style="background: linear-gradient(135deg, #9b59b6, #bb8fce);"></div>
            <span>Purple</span>
          </button>
          <button class="color-option" data-color="green" title="Green">
            <div class="color-preview" style="background: linear-gradient(135deg, #2ecc71, #7fd99f);"></div>
            <span>Green</span>
          </button>
          <button class="color-option" data-color="orange" title="Orange">
            <div class="color-preview" style="background: linear-gradient(135deg, #ff9f43, #ffbe76);"></div>
            <span>Orange</span>
          </button>
          <button class="color-option" data-color="blue" title="Blue">
            <div class="color-preview" style="background: linear-gradient(135deg, #5dade2, #85c1e9);"></div>
            <span>Blue</span>
          </button>
        </div>
      </div>
    </div>

    <div class="neo-container">
      <!-- Site Banner/Header -->
      <div class="site-banner">
        <div class="brand">nijika.de</div>
        <div class="header-controls">
          <button class="color-picker-toggle" title="Change color" data-color-picker>
            <i class="bi bi-palette"></i>
          </button>
          <button class="theme-toggle" title="Toggle theme" data-toggle-theme>
            <i class="bi bi-brightness-high"></i>
          </button>
        </div>
      </div>

      <div class="neo-layout">
        <aside class="neo-sidebar">
          <div class="neo-box">
            <div class="neo-header"><h3>Content</h3></div>
            <div class="neo-content">
              <ul>
                <li><a href="./blogs.html">Blogs</a></li>
                <li><a href="./stories.html">Stories</a></li>
                <li><a href="./add-post.html">Add Post</a></li>
              </ul>
            </div>
          </div>
          <div class="neo-box">
            <div class="neo-header"><h3>Site</h3></div>
            <div class="neo-content">
              <ul>
                <li><a href="./status.html">Status Strip</a></li>
                <li><a href="./now.html">Now Page</a></li>
                <li><a href="./changelog.html">Changelog</a></li>
                <li><a href="./resources.html">Resources</a></li>
                <li><a href="./favorites.html">Favorites</a></li>
                <li><a href="./settings.html">Settings</a></li>
              </ul>
            </div>
          </div>
        </aside>

        <main class="neo-main">
          <section class="neo-box">
            <div class="neo-header"><h2>Stories</h2></div>
            <div class="neo-content">
              <div id="posts" class="masonry-grid">
                <div class="loading">Loading stories...</div>
              </div>
            </div>
          </section>
        </main>
      </div>
    </div>

    <script type="module">
      import '../assets/app.js';
      async function load() {
        const root = document.querySelector('#posts');
        const res = await fetch('https://nijikade-backend.vercel.app/api/post?type=story');
        const data = await res.json();
        root.innerHTML = '';
        data.posts.forEach(year => {
          const yearHeader = document.createElement('div');
          yearHeader.className = 'year-header';
          yearHeader.textContent = year.year;
          root.appendChild(yearHeader);
          
          year.posts.forEach(post => {
            const card = document.createElement('div');
            card.className = 'masonry-item';
            card.innerHTML = `
              <div class="item-header">
                <h3><a href="./post.html?id=${post.id}">${post.title}</a></h3>
              </div>
              <div class="item-content">
                <div class="item-meta">
                  <span><i class="bi bi-calendar3"></i> ${post.date}</span>
                  <span class="chip">${post.tags || 'No tags'}</span>
                </div>
                <div class="item-actions" style="margin-top: 10px; display: flex; gap: 10px;">
                  <a class="btn btn-ghost" href="./update-post.html?id=${post.id}" title="Edit"><i class="bi bi-pencil"></i> Edit</a>
                  <button class="btn btn-ghost" data-del="${post.id}" title="Delete" style="color: #ff6b6b;"><i class="bi bi-trash"></i> Delete</button>
                </div>
              </div>
            `;
            root.appendChild(card);
          });
        });

        // Trigger scroll animations
        if (window.initScrollAnimations) {
          window.initScrollAnimations();
        }

        // Delete functionality
        root.addEventListener('click', async (e) => {
          const delBtn = e.target.closest('[data-del]');
          if (!delBtn) return;
          const id = delBtn.dataset.del;
          if (!confirm('Delete this post?')) return;
          try {
            const token = sessionStorage.getItem('jwt');
            await fetch(`https://nijikade-backend.vercel.app/api/post/${id}`, {
              method: 'DELETE',
              headers: { 'Authorization': `Bearer ${token}` }
            });
            location.reload();
          } catch (err) {
            alert('Failed to delete');
          }
        });
      }
      load();
    </script>
</body>
</html>
