<!doctype html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Admin Blogs Â· nijika.de</title>
    <link rel="stylesheet" href="./../assets/styles.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
  </head>
  <body>
    <header class="site-header">
      <div class="container nav">
        <div class="brand">nijika.de</div>
        <nav class="site-nav">
          <a href="./blogs.html">Blogs</a>
          <a href="./stories.html">Stories</a>
          <a href="./add-post.html">Add Post</a>
        </nav>
        <div class="nav-actions">
          <button class="theme-toggle" data-toggle-theme title="Toggle theme"><i class="bi bi-brightness-high"></i></button>
        </div>
      </div>
    </header>

    <main class="container" style="padding: 32px 0 48px;">
      <div class="section-head">
        <h2>Blogs</h2>
      </div>
      <div id="posts" class="post-list stack-4">Please wait...</div>
    </main>

    <script type="module">
      import '../assets/app.js';
      async function load() {
        const root = document.querySelector('#posts');
        const res = await fetch('https://nijikade-backend.vercel.app/api/post?type=blog');
        const data = await res.json();
        root.innerHTML = '';
        data.posts.forEach(year => {
          const y = document.createElement('h3'); y.textContent = year.year; root.appendChild(y);
          year.posts.forEach(post => {
            const div = document.createElement('div');
            div.className = 'post-item';
            div.innerHTML = `<a class="link" href="./post.html?id=${post.id}">${post.title}</a>
              <span class="row-actions">
                <a class="btn-icon" href="./update-post.html?id=${post.id}" title="Edit"><i class="bi bi-pencil"></i></a>
                <a class="btn-icon" href="#" data-del="${post.id}" title="Delete"><i class="bi bi-trash"></i></a>
              </span>`;
            root.appendChild(div);
          })
        })
        root.querySelectorAll('[data-del]').forEach(a => a.addEventListener('click', async (e) => {
          e.preventDefault();
          const id = a.getAttribute('data-del');
          const token = localStorage.getItem('jwt');
          if (!token) return alert('You are not logged in');
          if (!confirm('Delete this post?')) return;
          const delRes = await fetch(`https://nijikade-backend.vercel.app/api/post/${id}?token=${token}`, { method: 'DELETE' });
          if (!delRes.ok) return alert('Delete failed');
          alert('Post deleted');
          load();
        }))
      }
      load();
    </script>
  </body>
</html>


