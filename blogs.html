<!doctype html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Blogs · nijika.de</title>
    <meta name="description" content="Blogs" />
    <link rel="icon" type="image/x-icon" href="./img/favicon.ico" />
    <link rel="stylesheet" href="./assets/styles.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
  </head>
  <body onload="import('./assets/app.js').then(m=>m.getAllPosts('blog'))">
    <header class="site-header">
      <div class="container nav">
        <div class="brand">nijika.de</div>
        <nav class="site-nav">
          <a href="./">Home</a>
          <a href="./#about">About</a>
          <a href="./#portfolio">Portfolio</a>
          <a href="#">Blogs</a>
          <a href="./stories.html">Stories</a>
        </nav>
        <div class="nav-actions">
          <button class="theme-toggle" title="Toggle theme" data-toggle-theme><i class="bi bi-brightness-high"></i></button>
          <button class="burger" aria-label="Menu" data-toggle-menu><i class="bi bi-list"></i></button>
        </div>
      </div>
      <div class="mobile-bar container">
        <button class="theme-toggle" title="Toggle theme" data-toggle-theme><i class="bi bi-brightness-high"></i></button>
        <button class="btn btn-ghost" data-toggle-menu>Menu <i class="bi bi-caret-down-fill"></i></button>
      </div>
      <div class="mobile-menu container">
        <a href="./">Home</a>
        <a href="./#about">About</a>
        <a href="./#portfolio">Portfolio</a>
        <a href="#">Blogs</a>
        <a href="./stories.html">Stories</a>
      </div>
    </header>

    <main class="container" style="padding: 32px 0 48px;">
      <div class="section-head narrow">
        <h2>Blogs</h2>
      </div>
      <div class="filters">
        <input class="search" id="search" type="search" placeholder="Search posts..." />
        <button class="btn btn-ghost tags-toggle" id="toggleTags"><i class="bi bi-sliders"></i> Tags</button>
        <div class="selected-tags" id="selectedTags"></div>
        <div class="tags-dropdown" id="tagsDropdown">
          <div id="tagsBar"></div>
          <div class="actions">
            <button class="btn btn-primary" id="applyTags">Apply</button>
            <button class="btn btn-ghost" id="clearTags">Clear</button>
          </div>
        </div>
      </div>
      <div id="posts" class="post-list stack-4">Loading...</div>
    </main>

    <footer>
      <div class="stack-2">
        <div>
          <a class="link" href="https://twitter.com/twit_aurora">Twitter</a>
          · <a class="link" href="https://youtube.com/c/roraYT">YouTube</a>
          · <a class="link" href="mailto:chompajamas@gmail.com">Email</a>
        </div>
        <div>© 2025 nijika.de</div>
      </div>
    </footer>

    <script type="module">
      import './assets/app.js';
      const postsRoot = document.querySelector('#posts');
      const tagsBar = document.querySelector('#tagsBar');
      const searchInput = document.querySelector('#search');
      const toggleTagsBtn = document.querySelector('#toggleTags');
      const tagsDropdown = document.querySelector('#tagsDropdown');
      const selectedTagsBar = document.querySelector('#selectedTags');
      const applyBtn = document.querySelector('#applyTags');
      const clearBtn = document.querySelector('#clearTags');
      let all = [];
      let activeTags = new Set();

      function render(list){
        postsRoot.innerHTML = '';
        list.forEach(group => {
          const h = document.createElement('h3'); h.textContent = group.year; postsRoot.appendChild(h);
          group.posts.forEach(p => {
            const div = document.createElement('div');
            div.className = 'post-item';
            div.innerHTML = `<a class="link" href="./post.html?id=${p.id}">${p.title}</a>
            <div class="post-meta"><span>${p.date}</span><span class="chip">${p.tags || 'No tags'}</span></div>`;
            postsRoot.appendChild(div);
          });
        });
      }

      function collectTags(groups){
        const set = new Set();
        groups.forEach(g => (g.posts||[]).forEach(p => (p.tags||'').split(',').map(t=>t.trim()).filter(Boolean).forEach(t=>set.add(t))));
        return Array.from(set).sort();
      }

      function renderTags(tags){
        tagsBar.innerHTML = '';
        tags.forEach(tag => {
          const el = document.createElement('span');
          el.className = 'chip tag' + (activeTags.has(tag)?' active':'');
          el.textContent = tag;
          el.addEventListener('click', ()=>{
            if (activeTags.has(tag)) activeTags.delete(tag); else activeTags.add(tag);
            el.classList.toggle('active');
          });
          tagsBar.appendChild(el);
        });
      }

      function renderSelectedTags(){
        selectedTagsBar.innerHTML = '';
        if (activeTags.size === 0) return;
        activeTags.forEach(tag => {
          const chip = document.createElement('span');
          chip.className = 'chip tag active';
          chip.textContent = tag;
          chip.addEventListener('click', ()=>{ activeTags.delete(tag); filter(); });
          selectedTagsBar.appendChild(chip);
        });
      }

      function filter(){
        const q = searchInput.value.trim().toLowerCase();
        const out = all.map(group => ({
          year: group.year,
          posts: group.posts.filter(p => {
            const postTags = (p.tags||'').toLowerCase().split(',').map(s=>s.trim()).filter(Boolean);
            const inTag = activeTags.size===0 || Array.from(activeTags).every(t => postTags.includes(t.toLowerCase()));
            const inText = !q || p.title.toLowerCase().includes(q) || (p.tags||'').toLowerCase().includes(q);
            return inTag && inText;
          })
        })).filter(g => g.posts.length);
        render(out);
        renderSelectedTags();
      }

      (async function init(){
        const res = await fetch('https://nijikade-backend.vercel.app/api/post?type=blog');
        const data = await res.json();
        all = data.posts || [];
        render(all);
        renderTags(collectTags(all));
      })();

      searchInput.addEventListener('input', filter);
      toggleTagsBtn.addEventListener('click', () => {
        const isOpen = tagsDropdown.style.display === 'block';
        tagsDropdown.style.display = isOpen ? 'none' : 'block';
      });
      applyBtn.addEventListener('click', () => { tagsDropdown.style.display = 'none'; filter(); });
      clearBtn.addEventListener('click', () => { activeTags.clear(); filter(); tagsDropdown.style.display = 'none'; });
      document.addEventListener('click', (e) => {
        if (!tagsDropdown.contains(e.target) && !toggleTagsBtn.contains(e.target)) tagsDropdown.style.display = 'none';
      });
    </script>
  </body>
</html>


